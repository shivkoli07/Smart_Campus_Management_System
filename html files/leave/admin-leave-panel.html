<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Leave Panel</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

<style>
:root{
  --cream:#f9f7f3;
  --navy:#1e3a8a;
}

body{
  background: linear-gradient(135deg, var(--cream), #eef2f7);
}

/* Back button */
.back-btn{
  position:absolute;
  top:20px;
  right:20px;
}

/* Card */
.admin-card{
  border-radius: 18px;
  overflow: hidden;
}

/* Header */
.card-header-custom{
  background: var(--navy);
  color: white;
}

/* Table */
.table th, .table td{
  vertical-align: middle;
}

/* Status badges */
.badge-APPROVED{ background:#16a34a; }
.badge-REJECTED{ background:#dc2626; }
.badge-PENDING{ background:#f59e0b; }
</style>
</head>

<body>

<!-- Back Button -->
<div class="back-btn">
  <button class="btn btn-outline-dark btn-sm"
    onclick="window.location.href='leave-role.html'">
    <i class="fa-solid fa-arrow-left me-1"></i> Back
  </button>
</div>

<div class="container mt-5 mb-5">

  <div class="card admin-card shadow-lg">
    
    <!-- Header -->
    <div class="card-header card-header-custom text-center py-3">
      <h4 class="mb-0">
        <i class="fa-solid fa-file-circle-check me-2"></i>
        Leave Applications
      </h4>
    </div>

    <!-- Body -->
    <div class="card-body p-4">

      <div class="table-responsive">
        <table class="table table-hover table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th>Name</th>
              <th>Roll No</th>
              <th>Leave Type</th>
              <th>Dates</th>
              <th>Reason</th>
              <th>Status</th>
              <th style="width:140px">Action</th>
            </tr>
          </thead>
          <tbody id="leaveTable"></tbody>
        </table>
      </div>

    </div>
  </div>
</div>

<script>
function loadLeaves() {
  fetch("http://localhost:8080/api/leave")
    .then(res => res.json())
    .then(data => {
      let rows = "";

      data.forEach(l => {
        rows += `
          <tr>
            <td>${l.name}</td>
            <td>${l.rollNo}</td>
            <td>${l.leaveType}</td>
            <td>${l.fromDate} â†’ ${l.toDate}</td>
            <td>${l.reason}</td>
            <td>
              <span class="badge badge-${l.status}">
                ${l.status}
              </span>
            </td>
            <td>
              <button class="btn btn-success btn-sm me-1"
                onclick="updateStatus(${l.id}, 'APPROVED')">
                <i class="fa-solid fa-check"></i>
              </button>
              <button class="btn btn-danger btn-sm"
                onclick="updateStatus(${l.id}, 'REJECTED')">
                <i class="fa-solid fa-xmark"></i>
              </button>
            </td>
          </tr>
        `;
      });

      document.getElementById("leaveTable").innerHTML = rows;
    });
}

function updateStatus(id, status) {
  fetch(`http://localhost:8080/api/leave/${id}/status`, {
    method: "PUT",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({status})
  }).then(() => loadLeaves());
}

loadLeaves();
</script>

</body>
</html>
